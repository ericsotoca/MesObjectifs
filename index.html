<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4A90E2"/>
    <link rel="apple-touch-icon" href="icons/icon-192x192.png"> <!-- Créez ce fichier icon -->
    <link rel="manifest" href="manifest.json"> <!-- Créez ce fichier -->

    <title>Piliers de Vie</title>

    <style>
        /* --- CSS Global & Reset --- */
        :root {
            --font-family-sans: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            --font-family-serif: 'Georgia', 'Times New Roman', Times, serif;

            /* Couleurs Thème Clair (Défaut) */
            --bg-primary: #ffffff;
            --bg-secondary: #f0f4f8;
            --text-primary: #2c3e50;
            --text-secondary: #5a7084;
            --accent-primary: #4A90E2; /* Bleu principal */
            --accent-secondary: #50E3C2; /* Turquoise */
            --border-color: #dce4ec;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --danger-color: #e74c3c;
            --success-color: #2ecc71;

            /* Couleurs des Piliers */
            --pillar-color-1: #4CAF50; /* Santé (Vert) */
            --pillar-color-2: #2196F3; /* Dév. Perso (Bleu Ciel) */
            --pillar-color-3: #607D8B; /* Carrière (Gris Bleu) */
            --pillar-color-4: #FFC107; /* Finances (Ambre) */
            --pillar-color-5: #FF9800; /* Relations (Orange) */
            --pillar-color-6: #E91E63; /* Amour (Rose) */
            --pillar-color-7: #9C27B0; /* Loisirs (Violet) */
            --pillar-color-8: #3F51B5; /* Spiritualité (Indigo) */

            /* Tailles & Espacements */
            --spacing-xs: 4px;
            --spacing-s: 8px;
            --spacing-m: 16px;
            --spacing-l: 24px;
            --spacing-xl: 32px;
            --border-radius: 8px;
            --header-height: 50px;
            --nav-height: 60px;
        }

        /* --- Thème Sombre --- */
        body.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2c2c2c;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent-primary: #58a6ff; /* Bleu plus clair */
            --accent-secondary: #50E3C2; /* Turquoise (peut rester) */
            --border-color: #444444;
            --shadow-color: rgba(255, 255, 255, 0.05);
            --danger-color: #f87171;
            --success-color: #4ade80;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px; /* Base pour REM */
        }

        body {
            font-family: var(--font-family-sans);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overscroll-behavior-y: contain; /* Empêche le "pull-to-refresh" sur le body */
            padding-bottom: var(--nav-height); /* Espace pour la nav fixe en bas */
        }

        #app {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Pour que le footer reste en bas */
        }

        /* --- Header --- */
        header {
            background-color: var(--accent-primary);
            color: white;
            padding: 0 var(--spacing-m);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky; /* Ou fixed si besoin */
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px var(--shadow-color);
        }
        header h1 {
            font-size: 1.2rem;
            font-weight: 600;
        }
        #theme-toggle {
             background: none;
             border: none;
             color: white;
             font-size: 1.5rem; /* Taille de l'icône lune/soleil */
             cursor: pointer;
        }

        /* --- Main Content Area --- */
        main#content {
            flex-grow: 1;
            padding: var(--spacing-m);
            padding-bottom: calc(var(--nav-height) + var(--spacing-m)); /* Espace supplémentaire en bas */
            overflow-y: auto; /* Permet le scroll du contenu seulement */
        }

        /* --- View Management --- */
        .view {
            display: none; /* Caché par défaut */
            animation: fadeIn 0.3s ease-in-out;
        }
        .view.active {
            display: block; /* Affiché quand actif */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Navigation Bar (Bottom) --- */
        nav#bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--nav-height);
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            box-shadow: 0 -2px 5px var(--shadow-color);
        }
        nav#bottom-nav button {
            background: none;
            border: none;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            padding: var(--spacing-s) 0;
            cursor: pointer;
            transition: color 0.2s ease;
            flex-grow: 1; /* Pour occuper l'espace */
            position: relative;
        }
         nav#bottom-nav button svg { /* Styles pour les icônes SVG */
            width: 24px;
            height: 24px;
            margin-bottom: var(--spacing-xs);
            fill: currentColor; /* Utilise la couleur du bouton */
        }
        nav#bottom-nav button.active {
            color: var(--accent-primary);
            font-weight: 600;
        }
        nav#bottom-nav button.active::after { /* Indicateur actif */
             content: '';
             position: absolute;
             bottom: 0;
             left: 50%;
             transform: translateX(-50%);
             width: 40%;
             height: 3px;
             background-color: var(--accent-primary);
             border-radius: 3px 3px 0 0;
        }


        /* --- Generic Styles --- */
        .card {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: var(--spacing-m);
            margin-bottom: var(--spacing-m);
            box-shadow: 0 1px 3px var(--shadow-color);
            border: 1px solid var(--border-color);
        }

        h2 {
            color: var(--accent-primary);
            margin-bottom: var(--spacing-m);
            font-size: 1.4rem;
            border-bottom: 2px solid var(--accent-secondary);
            padding-bottom: var(--spacing-s);
        }
         h3 {
            color: var(--text-primary);
            margin-top: var(--spacing-l);
            margin-bottom: var(--spacing-s);
            font-size: 1.1rem;
        }

        button.primary, input[type="submit"] {
            background-color: var(--accent-primary);
            color: white;
            border: none;
            padding: var(--spacing-s) var(--spacing-m);
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s ease, transform 0.1s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-s);
        }
        button.primary:hover {
            background-color: color-mix(in srgb, var(--accent-primary), black 10%);
        }
         button.primary:active {
             transform: scale(0.98);
         }

        button.secondary {
             background-color: var(--bg-secondary);
             color: var(--text-primary);
             border: 1px solid var(--border-color);
             padding: var(--spacing-s) var(--spacing-m);
             border-radius: var(--border-radius);
             cursor: pointer;
             font-size: 1rem;
             transition: background-color 0.2s ease;
        }
        button.secondary:hover {
            background-color: color-mix(in srgb, var(--bg-secondary), black 5%);
        }
        button.danger {
            background-color: var(--danger-color);
            color: white;
        }
         button.danger:hover {
             background-color: color-mix(in srgb, var(--danger-color), black 10%);
         }


        /* --- Form Styles --- */
        form label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 600;
            color: var(--text-secondary);
        }
        form input[type="text"],
        form input[type="date"],
        form input[type="number"],
        form select,
        form textarea {
            width: 100%;
            padding: var(--spacing-s);
            margin-bottom: var(--spacing-m);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
        }
        form textarea {
            min-height: 100px;
            resize: vertical;
        }
        form input:focus, form select:focus, form textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-primary), transparent 70%);
        }

        /* --- Evaluation Styles --- */
        .evaluation-item {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-m);
            gap: var(--spacing-m);
        }
        .evaluation-item label {
            flex-basis: 150px; /* Ajustez si besoin */
            flex-shrink: 0;
            font-weight: normal;
            margin-bottom: 0;
             display: flex;
             align-items: center;
        }
        .evaluation-item input[type="range"] {
            flex-grow: 1;
            cursor: pointer;
        }
        .evaluation-item .score-display {
            font-weight: bold;
            min-width: 30px;
            text-align: right;
            color: var(--accent-primary);
        }
        .pillar-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: var(--spacing-s);
            vertical-align: middle;
        }

        /* --- Dashboard Styles --- */
        #radar-chart-container {
            width: 100%;
            max-width: 400px; /* Limite la taille max */
            margin: var(--spacing-l) auto;
            aspect-ratio: 1 / 1; /* Maintient un carré pour le radar */
            position: relative; /* Pour les labels potentiels */
        }
        #radar-chart-svg {
            display: block;
            width: 100%;
            height: 100%;
        }
        /* Style SVG de base (sera manipulé par JS) */
        #radar-chart-svg .axis {
            stroke: var(--border-color);
            stroke-width: 1px;
        }
        #radar-chart-svg .scale-line {
            stroke: var(--border-color);
            stroke-width: 0.5px;
            stroke-dasharray: 2, 2;
        }
        #radar-chart-svg .data-polygon {
            fill: color-mix(in srgb, var(--accent-primary), transparent 60%);
            stroke: var(--accent-primary);
            stroke-width: 2px;
        }
        #radar-chart-svg .axis-label {
            font-size: 0.7rem;
            fill: var(--text-secondary);
            text-anchor: middle; /* Sera ajusté par JS si besoin */
        }


        /* --- Goals List Styles --- */
        .goal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-s) 0;
            border-bottom: 1px solid var(--border-color);
            gap: var(--spacing-m);
        }
        .goal-item:last-child {
            border-bottom: none;
        }
        .goal-info {
             flex-grow: 1;
             display: flex;
             align-items: center;
             gap: var(--spacing-s);
        }
        .goal-title {
            font-weight: 600;
             margin-right: auto; /* Pousse la date à droite */
        }
        .goal-item.completed .goal-title {
            text-decoration: line-through;
            color: var(--text-secondary);
        }
        .goal-due-date {
            font-size: 0.8rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }
        .goal-actions button {
            padding: var(--spacing-xs);
            font-size: 1.2rem; /* Taille icônes actions */
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s ease;
        }
         .goal-actions button.complete-btn { color: var(--success-color); }
         .goal-actions button.delete-btn { color: var(--danger-color); }
         .goal-actions button:hover { color: var(--accent-primary); }

        /* --- Journal Styles --- */
        .journal-entry {
            background-color: var(--bg-secondary);
            padding: var(--spacing-s) var(--spacing-m);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-m);
            border-left: 4px solid var(--accent-secondary);
        }
        .journal-entry-date {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }
        .journal-entry-content {
            white-space: pre-wrap; /* Respecte les sauts de ligne */
        }
         #add-journal-entry {
             width: 100%;
             margin-top: var(--spacing-m);
         }

        /* --- Settings Styles --- */
        .settings-section {
            margin-bottom: var(--spacing-xl);
        }
         .settings-section button {
             margin-right: var(--spacing-m);
             margin-bottom: var(--spacing-s);
         }
         #import-data-input {
             display: none; /* Caché, activé par le bouton */
         }

        /* --- Utility Classes --- */
        .text-center { text-align: center; }
        .mt-1 { margin-top: var(--spacing-s); }
        .mt-2 { margin-top: var(--spacing-m); }
        .mb-1 { margin-bottom: var(--spacing-s); }
        .mb-2 { margin-bottom: var(--spacing-m); }

        /* --- Responsive --- */
        @media (min-width: 768px) {
            body {
               /* Peut-être passer à une nav latérale sur desktop? */
               /* Pour l'instant, on garde la nav en bas mais on centre le contenu */
               padding-bottom: 0; /* Supprimer le padding si la nav change */
            }
             #app {
                 max-width: 800px; /* Limite la largeur sur grand écran */
             }
            /* Exemple si on passait à une nav latérale */
            /*
            body { display: flex; }
            #app { flex-direction: row; }
            nav#bottom-nav { position: static; width: 200px; height: 100vh; flex-direction: column; justify-content: flex-start; padding-top: var(--spacing-l); box-shadow: 2px 0 5px var(--shadow-color); }
            nav#bottom-nav button { width: 100%; justify-content: flex-start; padding: var(--spacing-m); font-size: 1rem; }
            nav#bottom-nav button svg { margin-right: var(--spacing-m); margin-bottom: 0; }
            nav#bottom-nav button.active::after { display: none; } // Supprimer l'indicateur du bas
            nav#bottom-nav button.active { background-color: color-mix(in srgb, var(--accent-primary), transparent 80%); }
            main#content { height: 100vh; overflow-y: auto; }
            header { position: static; } // Header ne serait plus sticky
            */
        }

         /* --- Style d'impression --- */
        @media print {
            body {
                background-color: white;
                color: black;
                font-size: 12pt;
                padding-bottom: 0;
            }
            header, nav#bottom-nav, button, input[type="submit"], .no-print {
                display: none !important; /* Cacher les éléments non pertinents */
            }
            main#content {
                padding: 1cm;
                 overflow: visible;
                 height: auto;
            }
            .card, .journal-entry {
                 box-shadow: none;
                 border: 1px solid #ccc;
                 page-break-inside: avoid; /* Essayer d'éviter de couper les éléments */
                 background-color: #f9f9f9;
            }
             h2, h3 {
                 color: black;
                 border-bottom: 1px solid #ccc;
                 page-break-after: avoid;
             }
             #radar-chart-container {
                 max-width: 100%;
                 page-break-inside: avoid;
             }
             .goal-item {
                 border-bottom: 1px dotted #ccc;
             }
             .goal-actions { display: none; } /* Cacher les boutons d'action */
             .pillar-dot {
                 border: 1px solid #ccc; /* Rendre visible en N&B */
                 background-color: lightgray !important; /* Simplifier couleur */
             }
             /* Styles spécifiques pour rendre les couleurs des piliers en N&B si nécessaire */
             [style*="--pillar-color-1"] .pillar-dot { /* ... */ }
        }

    </style>
</head>
<body>
    <div id="app">
        <header>
            <h1>Piliers de Vie</h1>
            <button id="theme-toggle" aria-label="Changer de thème">🌙</button> <!-- Icône change avec JS -->
        </header>

        <main id="content">
            <!-- Les vues seront chargées ici par JavaScript -->

            <!-- === Vue Tableau de Bord === -->
            <div id="dashboard-view" class="view active">
                <h2>Tableau de Bord</h2>
                <div class="card">
                    <h3>Équilibre des Piliers</h3>
                    <div id="radar-chart-container">
                        <!-- Le graphique SVG sera généré ici par JS -->
                        <svg id="radar-chart-svg" viewBox="0 0 100 100"></svg>
                        <p id="radar-chart-placeholder" class="text-center text-secondary" style="display: none;">Évaluez vos piliers dans les paramètres pour voir le graphique.</p>
                    </div>
                </div>
                <div class="card">
                    <h3>Objectifs Prochains</h3>
                    <div id="upcoming-goals">
                        <!-- Les objectifs proches seront listés ici par JS -->
                        <p class="text-secondary">Aucun objectif défini pour le moment.</p>
                    </div>
                </div>
                 <div class="card">
                    <h3>Progression Récente</h3>
                    <div id="progress-summary">
                        <!-- Un résumé de la progression sera affiché ici par JS -->
                        <p class="text-secondary">Suivez vos objectifs pour voir votre progression.</p>
                    </div>
                 </div>
            </div>

            <!-- === Vue Liste des Piliers/Objectifs === -->
            <div id="goals-view" class="view">
                <h2>Objectifs par Pilier</h2>
                <div id="goals-list-container">
                    <!-- Le contenu (liste des piliers puis objectifs) sera généré par JS -->
                    <p class="text-secondary">Commencez par ajouter un objectif !</p>
                </div>
            </div>

             <!-- === Vue Ajout/Modification Objectif === -->
             <div id="add-edit-goal-view" class="view">
                 <h2 id="goal-form-title">Ajouter un Objectif</h2>
                 <form id="goal-form" class="card">
                    <input type="hidden" id="goal-id"> <!-- Pour l'édition -->
                    <div>
                        <label for="goal-title-input">Nom de l'objectif (Spécifique)</label>
                        <input type="text" id="goal-title-input" required placeholder="Ex: Courir 5km sans m'arrêter">
                    </div>
                    <div>
                        <label for="goal-pillar-select">Pilier de Vie</label>
                        <select id="goal-pillar-select" required>
                            <!-- Options générées par JS -->
                        </select>
                    </div>
                    <div>
                        <label for="goal-measurable-input">Critère de succès (Mesurable)</label>
                        <textarea id="goal-measurable-input" placeholder="Ex: Temps cible, fréquence, indicateur clé..."></textarea>
                    </div>
                    <div>
                        <label for="goal-due-date-input">Échéance (Temporel)</label>
                        <input type="date" id="goal-due-date-input" required>
                    </div>
                     <div>
                         <label for="goal-notes-input">Notes / Étapes clés (Optionnel)</label>
                        <textarea id="goal-notes-input" placeholder="Décrivez les étapes pour atteindre cet objectif..."></textarea>
                     </div>
                    <button type="submit" class="primary">
                         <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"/></svg>
                        <span id="goal-form-submit-text">Enregistrer l'Objectif</span>
                    </button>
                    <button type="button" id="cancel-goal-form" class="secondary no-print" style="margin-left: var(--spacing-m);">Annuler</button>
                 </form>
            </div>

            <!-- === Vue Journal === -->
            <div id="journal-view" class="view">
                <h2>Journal de Réflexion</h2>
                <div class="card">
                    <form id="journal-form">
                        <label for="journal-entry-input">Nouvelle entrée</label>
                        <textarea id="journal-entry-input" required placeholder="Notez vos pensées, difficultés, réussites..."></textarea>
                        <button type="submit" class="primary">
                             <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                            Ajouter au Journal
                        </button>
                    </form>
                </div>
                <h3>Entrées précédentes</h3>
                <div id="journal-entries-list">
                    <!-- Les entrées seront listées ici par JS -->
                    <p class="text-secondary">Votre journal est vide pour le moment.</p>
                </div>
            </div>

            <!-- === Vue Paramètres === -->
            <div id="settings-view" class="view">
                <h2>Paramètres</h2>

                <div class="settings-section card">
                     <h3>Évaluation des Piliers</h3>
                     <p class="text-secondary mb-2">Évaluez votre satisfaction actuelle (1 à 10) dans chaque pilier.</p>
                     <form id="evaluation-form">
                         <!-- Les sliders d'évaluation seront générés ici par JS -->
                         <div id="evaluation-items-container"></div>
                         <button type="submit" class="primary">Enregistrer l'Évaluation</button>
                     </form>
                </div>

                <div class="settings-section card">
                     <h3>Préférences</h3>
                     <button id="toggle-theme-button" class="secondary">Passer au thème Sombre/Clair</button>
                     <!-- Autres préférences futures possibles -->
                </div>

                <div class="settings-section card">
                    <h3>Données</h3>
                     <p class="text-secondary mb-2">Sauvegardez ou restaurez vos données.</p>
                    <button id="export-data-button" class="secondary">
                         <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 9h-4V3H9v6H5l7 7 7-7zm-8 2V5h2v6h1.17L12 13.17 9.83 11H11zm-6 7h14v2H5v-2z"/></svg>
                        Exporter les Données (.json)
                    </button>
                    <button id="import-data-button" class="secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><g><rect fill="none" height="24" width="24"/></g><g><path d="M14,2H6C4.9,2,4,2.9,4,4v16c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V8L14,2z M18,20H6V4h7v5h5V20z M12,12L8,16h3v4h2v-4h3 L12,12z"/></g></svg>
                        Importer les Données
                    </button>
                    <input type="file" id="import-data-input" accept=".json">
                    <p id="import-status" class="mt-1 text-secondary"></p>
                </div>

                 <div class="settings-section card">
                    <h3>Aide & Infos</h3>
                     <p class="text-secondary">Version 1.0.0 (Alpha)</p>
                     <p><a href="[URL_DE_VOTRE_REPO_GITHUB]" target="_blank" rel="noopener noreferrer">Voir sur GitHub</a></p>
                     <!-- Ajouter lien vers README ou licence -->
                </div>
            </div>

        </main>

        <nav id="bottom-nav">
             <!-- Icônes SVG simples. Remplacez par de meilleures icônes si possible -->
            <button class="nav-button active" data-view="dashboard-view" aria-label="Tableau de bord">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM11 7h2v2h-2zm0 4h2v6h-2zm-4 4h2v2H7z"/></svg>
                <span>Dashboard</span>
            </button>
            <button class="nav-button" data-view="goals-view" aria-label="Objectifs">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22L14 6z"/></svg>
                <span>Objectifs</span>
            </button>
             <button class="nav-button" data-view="add-edit-goal-view" aria-label="Ajouter objectif">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></svg>
                <span>Ajouter</span>
             </button>
            <button class="nav-button" data-view="journal-view" aria-label="Journal">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                <span>Journal</span>
            </button>
            <button class="nav-button" data-view="settings-view" aria-label="Paramètres">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.08-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
                <span>Paramètres</span>
            </button>
        </nav>
    </div><!-- /#app -->

    <script>
        // --- JavaScript Application Logic ---

        document.addEventListener('DOMContentLoaded', () => {
            // --- Constants & State ---
            const PILLARS = [
                { id: 1, name: "Santé physique et bien-être", colorVar: "--pillar-color-1", score: 5 },
                { id: 2, name: "Développement personnel et croissance intellectuelle", colorVar: "--pillar-color-2", score: 5 },
                { id: 3, name: "Carrière et ambitions professionnelles", colorVar: "--pillar-color-3", score: 5 },
                { id: 4, name: "Finances et sécurité matérielle", colorVar: "--pillar-color-4", score: 5 },
                { id: 5, name: "Relations familiales et amicales", colorVar: "--pillar-color-5", score: 5 },
                { id: 6, name: "Amour et vie sentimentale", colorVar: "--pillar-color-6", score: 5 },
                { id: 7, name: "Loisirs, passions et créativité", colorVar: "--pillar-color-7", score: 5 },
                { id: 8, name: "Spiritualité et sens de la vie", colorVar: "--pillar-color-8", score: 5 }
            ];

            // Application state (loaded from localStorage or default)
            let appData = {
                pillars: JSON.parse(JSON.stringify(PILLARS)), // Deep copy for initial state
                goals: [], // { id, pillarId, title, measurable, dueDate, notes, status: 'pending'/'completed', createdAt, completedAt }
                journal: [], // { id, date, content }
                settings: {
                    theme: 'light', // 'light' or 'dark'
                    lastEvaluationDate: null
                }
            };

            // --- DOM Elements ---
            const appElement = document.getElementById('app');
            const contentElement = document.getElementById('content');
            const navButtons = document.querySelectorAll('.nav-button');
            const views = document.querySelectorAll('.view');
            const themeToggleButton = document.getElementById('theme-toggle');
            const evaluationForm = document.getElementById('evaluation-form');
            const evaluationItemsContainer = document.getElementById('evaluation-items-container');
            const radarChartContainer = document.getElementById('radar-chart-container');
            const radarChartSVG = document.getElementById('radar-chart-svg');
            const radarChartPlaceholder = document.getElementById('radar-chart-placeholder');
            const goalForm = document.getElementById('goal-form');
            const goalFormTitle = document.getElementById('goal-form-title');
            const goalFormSubmitText = document.getElementById('goal-form-submit-text');
            const cancelGoalFormButton = document.getElementById('cancel-goal-form');
            const goalPillarSelect = document.getElementById('goal-pillar-select');
            const goalsListContainer = document.getElementById('goals-list-container');
            const upcomingGoalsContainer = document.getElementById('upcoming-goals');
            const journalForm = document.getElementById('journal-form');
            const journalEntryInput = document.getElementById('journal-entry-input');
            const journalEntriesList = document.getElementById('journal-entries-list');
            const exportButton = document.getElementById('export-data-button');
            const importButton = document.getElementById('import-data-button');
            const importInput = document.getElementById('import-data-input');
            const importStatus = document.getElementById('import-status');
            const toggleThemeButton = document.getElementById('toggle-theme-button');

            // --- Initialization ---
            function init() {
                loadData();
                setupEventListeners();
                renderPillarOptions();
                renderEvaluationForm();
                applyTheme(appData.settings.theme);
                showView('dashboard-view'); // Start on dashboard
                renderDashboard();
                renderGoalsList();
                renderJournal();
                registerServiceWorker(); // PWA
                console.log("Piliers de Vie App Initialized");
            }

            // --- Data Persistence (localStorage) ---
            function saveData() {
                try {
                    localStorage.setItem('piliersDeVieData', JSON.stringify(appData));
                    console.log("Data saved");
                } catch (error) {
                    console.error("Error saving data to localStorage:", error);
                    alert("Erreur lors de la sauvegarde des données. L'espace de stockage est peut-être plein.");
                }
            }

            function loadData() {
                const savedData = localStorage.getItem('piliersDeVieData');
                if (savedData) {
                    try {
                        const parsedData = JSON.parse(savedData);
                        // Merge saved data with defaults to ensure all keys exist
                        appData = {
                            pillars: parsedData.pillars || JSON.parse(JSON.stringify(PILLARS)),
                            goals: parsedData.goals || [],
                            journal: parsedData.journal || [],
                            settings: { ...appData.settings, ...parsedData.settings }
                        };
                        // Ensure pillar scores are numbers
                         appData.pillars.forEach(p => p.score = Number(p.score) || 5);
                        console.log("Data loaded");
                    } catch (error) {
                        console.error("Error parsing data from localStorage:", error);
                        // Keep default data if parsing fails
                    }
                } else {
                     // First time load or cleared storage, ensure default scores are set
                     appData.pillars.forEach(p => p.score = 5);
                     saveData(); // Save initial default data
                }
                 // Migrate old data structures if needed here
            }

            // --- View Management ---
            function showView(viewId) {
                views.forEach(view => {
                    view.classList.remove('active');
                });
                const targetView = document.getElementById(viewId);
                if (targetView) {
                    targetView.classList.add('active');
                }

                // Update active nav button
                navButtons.forEach(button => {
                    button.classList.remove('active');
                    if (button.dataset.view === viewId || (viewId === 'add-edit-goal-view' && button.dataset.view === 'add-edit-goal-view')) {
                         button.classList.add('active');
                    }
                     // Handle Add button differently - it opens a specific view but isn't a primary view itself
                     if (viewId === 'add-edit-goal-view' && button.getAttribute('aria-label') === 'Ajouter objectif') {
                         button.classList.add('active');
                     } else if (viewId !== 'add-edit-goal-view' && button.getAttribute('aria-label') === 'Ajouter objectif') {
                         button.classList.remove('active'); // Deactivate add button if not on the form view
                     }
                });

                // Reset add/edit goal form when navigating away or to it for adding
                 if (viewId === 'add-edit-goal-view') {
                     // If navigating TO the add view via the '+' button, ensure it's reset
                     const isAdding = !document.getElementById('goal-id').value;
                     if(isAdding) {
                         resetGoalForm();
                     }
                 }

                 // Scroll to top of new view
                 contentElement.scrollTop = 0;
            }

            // --- Theme Management ---
             function applyTheme(theme) {
                 if (theme === 'dark') {
                     document.body.classList.add('dark-mode');
                     themeToggleButton.textContent = '☀️'; // Sun icon
                     themeToggleButton.setAttribute('aria-label', 'Passer au thème clair');
                     // Update PWA theme color if possible (requires manifest update or JS)
                     document.querySelector('meta[name="theme-color"]').setAttribute('content', '#1a1a1a');
                 } else {
                     document.body.classList.remove('dark-mode');
                     themeToggleButton.textContent = '🌙'; // Moon icon
                      themeToggleButton.setAttribute('aria-label', 'Passer au thème sombre');
                     document.querySelector('meta[name="theme-color"]').setAttribute('content', '#4A90E2');
                 }
                 appData.settings.theme = theme;
                 // Re-render chart if needed as colors might change
                 renderDashboardChart();
             }

            function toggleTheme() {
                const newTheme = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
                applyTheme(newTheme);
                saveData();
            }


            // --- Event Listeners Setup ---
            function setupEventListeners() {
                // Navigation
                navButtons.forEach(button => {
                    button.addEventListener('click', () => {
                         const viewId = button.dataset.view;
                         if (viewId) {
                             // Special case for add button: always reset form before showing
                             if (viewId === 'add-edit-goal-view') {
                                 resetGoalForm();
                             }
                             showView(viewId);
                         }
                    });
                });

                // Theme Toggle
                themeToggleButton.addEventListener('click', toggleTheme);
                toggleThemeButton.addEventListener('click', toggleTheme); // Listener for the settings button too

                // Evaluation Form
                evaluationForm.addEventListener('submit', handleEvaluationSubmit);

                // Goal Form
                goalForm.addEventListener('submit', handleGoalSubmit);
                cancelGoalFormButton.addEventListener('click', () => showView('goals-view')); // Or dashboard?

                 // Goals List (Event delegation for dynamic elements)
                goalsListContainer.addEventListener('click', handleGoalAction);

                // Journal Form
                journalForm.addEventListener('submit', handleJournalSubmit);
                 journalEntriesList.addEventListener('click', handleJournalAction); // For delete button

                // Data Export/Import
                exportButton.addEventListener('click', exportData);
                importButton.addEventListener('click', () => importInput.click()); // Trigger hidden file input
                importInput.addEventListener('change', handleImportFile);
            }


             // --- Rendering Functions ---

             function getPillarColor(pillarId) {
                 const pillar = appData.pillars.find(p => p.id === pillarId);
                 return pillar ? `var(${pillar.colorVar})` : 'var(--text-secondary)';
             }
              function getPillarName(pillarId) {
                 const pillar = appData.pillars.find(p => p.id === pillarId);
                 return pillar ? pillar.name : 'Inconnu';
             }

             // Render pillar options in select dropdown
             function renderPillarOptions() {
                 goalPillarSelect.innerHTML = '<option value="" disabled selected>Choisir un pilier...</option>';
                 appData.pillars.forEach(pillar => {
                     const option = document.createElement('option');
                     option.value = pillar.id;
                     option.textContent = pillar.name;
                     // Add color dot? Could be complex for select options. Maybe style the select itself?
                     goalPillarSelect.appendChild(option);
                 });
             }

            // Render evaluation sliders/inputs
             function renderEvaluationForm() {
                 evaluationItemsContainer.innerHTML = ''; // Clear previous
                 appData.pillars.forEach(pillar => {
                     const div = document.createElement('div');
                     div.className = 'evaluation-item';

                     const label = document.createElement('label');
                     label.htmlFor = `eval-pillar-${pillar.id}`;

                     const dot = document.createElement('span');
                     dot.className = 'pillar-dot';
                     dot.style.backgroundColor = getPillarColor(pillar.id);
                     label.appendChild(dot);
                     label.appendChild(document.createTextNode(pillar.name));

                     const range = document.createElement('input');
                     range.type = 'range';
                     range.id = `eval-pillar-${pillar.id}`;
                     range.min = 1;
                     range.max = 10;
                     range.value = pillar.score;
                     range.dataset.pillarId = pillar.id;

                     const scoreDisplay = document.createElement('span');
                     scoreDisplay.className = 'score-display';
                     scoreDisplay.textContent = pillar.score;

                     // Update display on input change
                     range.addEventListener('input', (e) => {
                         scoreDisplay.textContent = e.target.value;
                     });

                     div.appendChild(label);
                     div.appendChild(range);
                     div.appendChild(scoreDisplay);
                     evaluationItemsContainer.appendChild(div);
                 });
             }

             // Render the dashboard (chart + summaries)
             function renderDashboard() {
                 renderDashboardChart();
                 renderUpcomingGoalsSummary();
                 renderProgressSummary(); // TODO: Implement progress summary logic
             }

            // Render the Radar Chart (SVG Generation - COMPLEX)
             function renderDashboardChart() {
                 radarChartSVG.innerHTML = ''; // Clear previous SVG content

                 // Check if evaluation has been done (e.g., not all scores are default 5)
                 const isEvaluated = appData.pillars.some(p => p.score !== 5) || appData.settings.lastEvaluationDate;

                 if (!isEvaluated && appData.goals.length === 0) { // Show placeholder only if truly empty start
                     radarChartPlaceholder.style.display = 'block';
                     radarChartSVG.style.display = 'none';
                     return;
                 }
                  radarChartPlaceholder.style.display = 'none';
                  radarChartSVG.style.display = 'block';


                 const svgSize = 100; // ViewBox size
                 const center = svgSize / 2;
                 const radius = svgSize * 0.4; // Max radius
                 const numAxes = appData.pillars.length;
                 const angleSlice = (Math.PI * 2) / numAxes;

                 // --- Draw Axes and Scale Lines ---
                 const axesGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
                 axesGroup.setAttribute("class", "axes");

                 for (let i = 0; i < numAxes; i++) {
                     const angle = angleSlice * i - Math.PI / 2; // Start from top
                     const x2 = center + radius * Math.cos(angle);
                     const y2 = center + radius * Math.sin(angle);

                     // Axis line
                     const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                     line.setAttribute("x1", center);
                     line.setAttribute("y1", center);
                     line.setAttribute("x2", x2);
                     line.setAttribute("y2", y2);
                     line.setAttribute("class", "axis");
                     axesGroup.appendChild(line);

                      // Axis Label (Pillar Name or Number)
                      const labelRadius = radius * 1.15; // Position labels outside the max radius
                      const labelX = center + labelRadius * Math.cos(angle);
                      const labelY = center + labelRadius * Math.sin(angle);
                      const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                      text.setAttribute("x", labelX);
                      text.setAttribute("y", labelY);
                      text.setAttribute("class", "axis-label");
                      text.setAttribute("dominant-baseline", "middle");
                      text.textContent = appData.pillars[i].name.split(' ')[0]; // Short name
                     // Adjust text anchor based on position
                     if (Math.abs(labelX - center) < 0.1) text.setAttribute("text-anchor", "middle");
                     else if (labelX > center) text.setAttribute("text-anchor", "start");
                     else text.setAttribute("text-anchor", "end");

                     axesGroup.appendChild(text);
                 }

                  // Scale lines (circles/polygons) - e.g., at 25%, 50%, 75%, 100%
                 const scaleLevels = 4;
                 for (let j = 1; j <= scaleLevels; j++) {
                      const scaleRadius = radius * (j / scaleLevels);
                      const scalePolygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
                      let scalePoints = "";
                      for (let i = 0; i < numAxes; i++) {
                          const angle = angleSlice * i - Math.PI / 2;
                          const x = center + scaleRadius * Math.cos(angle);
                          const y = center + scaleRadius * Math.sin(angle);
                          scalePoints += `${x},${y} `;
                      }
                      scalePolygon.setAttribute("points", scalePoints.trim());
                      scalePolygon.setAttribute("class", "scale-line");
                      scalePolygon.setAttribute("fill", "none");
                      axesGroup.appendChild(scalePolygon);
                  }


                 radarChartSVG.appendChild(axesGroup);

                 // --- Draw Data Polygon ---
                 const dataGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
                 dataGroup.setAttribute("class", "data");

                 const dataPolygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
                 let dataPoints = "";
                 appData.pillars.forEach((pillar, i) => {
                     const score = Math.max(1, pillar.score); // Ensure score is at least 1 for visibility
                     const pointRadius = radius * (score / 10); // Scale score to radius
                     const angle = angleSlice * i - Math.PI / 2;
                     const x = center + pointRadius * Math.cos(angle);
                     const y = center + pointRadius * Math.sin(angle);
                     dataPoints += `${x},${y} `;
                 });

                 dataPolygon.setAttribute("points", dataPoints.trim());
                 dataPolygon.setAttribute("class", "data-polygon");
                 // Could set fill/stroke based on average score or theme
                 dataGroup.appendChild(dataPolygon);

                 // Optional: Add points/circles at each vertex
                 appData.pillars.forEach((pillar, i) => {
                      const score = Math.max(1, pillar.score);
                      const pointRadius = radius * (score / 10);
                      const angle = angleSlice * i - Math.PI / 2;
                      const x = center + pointRadius * Math.cos(angle);
                      const y = center + pointRadius * Math.sin(angle);
                      const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                      circle.setAttribute("cx", x);
                      circle.setAttribute("cy", y);
                      circle.setAttribute("r", "3"); // Small radius for points
                      circle.setAttribute("fill", getPillarColor(pillar.id));
                      dataGroup.appendChild(circle);
                 });


                 radarChartSVG.appendChild(dataGroup);
             }

            // Render upcoming goals summary on Dashboard
            function renderUpcomingGoalsSummary() {
                upcomingGoalsContainer.innerHTML = ''; // Clear
                const now = new Date();
                const oneWeekLater = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);

                const upcoming = appData.goals
                    .filter(goal => goal.status === 'pending' && new Date(goal.dueDate) >= now && new Date(goal.dueDate) <= oneWeekLater)
                    .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))
                    .slice(0, 5); // Show max 5

                if (upcoming.length === 0) {
                    upcomingGoalsContainer.innerHTML = '<p class="text-secondary">Aucun objectif prévu dans les 7 prochains jours.</p>';
                    return;
                }

                const ul = document.createElement('ul');
                 ul.style.listStyle = 'none';
                 ul.style.paddingLeft = '0';
                upcoming.forEach(goal => {
                    const li = document.createElement('li');
                    li.className = 'goal-item mb-1'; // Use similar styling
                     li.style.borderBottom = 'none'; // Remove border for summary view
                    li.innerHTML = `
                        <div class="goal-info">
                            <span class="pillar-dot" style="background-color: ${getPillarColor(goal.pillarId)}; flex-shrink: 0;"></span>
                            <span class="goal-title">${escapeHtml(goal.title)}</span>
                            <span class="goal-due-date">${formatDate(goal.dueDate)}</span>
                        </div>
                    `;
                    ul.appendChild(li);
                });
                upcomingGoalsContainer.appendChild(ul);
            }

            // Placeholder for progress summary
             function renderProgressSummary() {
                 const summaryContainer = document.getElementById('progress-summary');
                 summaryContainer.innerHTML = ''; // Clear

                 const completedRecently = appData.goals.filter(g =>
                     g.status === 'completed' &&
                     g.completedAt &&
                     (new Date() - new Date(g.completedAt)) < (7 * 24 * 60 * 60 * 1000) // Completed in last 7 days
                 ).length;

                 const pendingCount = appData.goals.filter(g => g.status === 'pending').length;

                 if (appData.goals.length === 0) {
                    summaryContainer.innerHTML = '<p class="text-secondary">Suivez vos objectifs pour voir votre progression.</p>';
                     return;
                 }

                 let summaryHTML = `<p><strong>${completedRecently}</strong> objectif(s) complété(s) cette semaine.</p>`;
                 summaryHTML += `<p><strong>${pendingCount}</strong> objectif(s) en cours.</p>`;
                  // TODO: Add more sophisticated stats like streak from journal/tracking

                  summaryContainer.innerHTML = summaryHTML;
             }


             // Render the main goals list (grouped by pillar or time frame)
             function renderGoalsList() {
                 goalsListContainer.innerHTML = ''; // Clear

                 if (appData.goals.length === 0) {
                     goalsListContainer.innerHTML = `
                        <p class="text-center text-secondary mt-2">Vous n'avez pas encore défini d'objectifs.</p>
                        <div class="text-center mt-2">
                           <button class="primary" onclick="document.querySelector('[data-view=add-edit-goal-view]').click()">
                                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                                Ajouter le premier objectif
                           </button>
                        </div>`;
                     return;
                 }

                 // Group goals by pillar for display
                 const goalsByPillar = {};
                 appData.pillars.forEach(p => goalsByPillar[p.id] = []);
                 appData.goals.forEach(goal => {
                     if (goalsByPillar[goal.pillarId]) {
                         goalsByPillar[goal.pillarId].push(goal);
                     } else {
                          // Handle potential orphan goals if pillar deleted? (Shouldn't happen with fixed pillars)
                          console.warn("Goal found for non-existent pillar ID:", goal.pillarId);
                     }
                 });


                  // Define sorting order: pending first (by due date asc), then completed (by completed date desc)
                  const sortGoals = (a, b) => {
                      if (a.status === 'pending' && b.status === 'completed') return -1;
                      if (a.status === 'completed' && b.status === 'pending') return 1;
                      if (a.status === 'pending') {
                          return new Date(a.dueDate) - new Date(b.dueDate); // Pending by due date asc
                      } else { // Both completed
                          return new Date(b.completedAt) - new Date(a.completedAt); // Completed by completion date desc
                      }
                  };


                 appData.pillars.forEach(pillar => {
                     const pillarGoals = goalsByPillar[pillar.id].sort(sortGoals);
                     if (pillarGoals.length > 0) {
                         const section = document.createElement('div');
                         section.className = 'pillar-goal-section card'; // Use card style per pillar
                         section.innerHTML = `<h3>
                            <span class="pillar-dot" style="background-color: ${getPillarColor(pillar.id)};"></span>
                            ${pillar.name} (${pillarGoals.filter(g => g.status === 'pending').length} en cours)
                            </h3>`;

                         const ul = document.createElement('ul');
                          ul.style.listStyle = 'none';
                          ul.style.paddingLeft = '0';

                         pillarGoals.forEach(goal => {
                             const li = document.createElement('li');
                             li.className = `goal-item ${goal.status === 'completed' ? 'completed' : ''}`;
                             li.dataset.goalId = goal.id;

                             // Determine time category based on due date
                             const term = getGoalTerm(goal.dueDate);
                             let termBadge = '';
                             if (goal.status === 'pending') {
                                 if (term === 'short') termBadge = '<span class="badge short-term">Court</span>';
                                 else if (term === 'medium') termBadge = '<span class="badge medium-term">Moyen</span>';
                                 else if (term === 'long') termBadge = '<span class="badge long-term">Long</span>';
                             }


                             li.innerHTML = `
                                <div class="goal-info">
                                    <span class="pillar-dot" style="background-color: ${getPillarColor(goal.pillarId)}; flex-shrink: 0;"></span>
                                    <span class="goal-title">${escapeHtml(goal.title)}</span>
                                     <span class="goal-due-date">
                                         ${goal.status === 'pending' ? 'Échéance: ' + formatDate(goal.dueDate) : 'Terminé: ' + formatDate(goal.completedAt)}
                                         ${/*termBadge*/ ''}  <!-- Badges can be added with CSS -->
                                     </span>
                                </div>
                                <div class="goal-actions no-print">
                                     ${goal.status === 'pending' ?
                                         `<button class="complete-btn" title="Marquer comme terminé">
                                             <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M9 16.2l-3.5-3.5c-.39-.39-1.01-.39-1.4 0-.39.39-.39 1.01 0 1.4l4.19 4.19c.39.39 1.02.39 1.41 0L20.3 7.7c.39-.39.39-1.01 0-1.4-.39-.39-1.01-.39-1.4 0L9 16.2z"/></svg>
                                         </button>` :
                                         `<button class="uncomplete-btn" title="Marquer comme non terminé">
                                             <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                                         </button>`
                                     }
                                    <button class="edit-btn" title="Modifier">
                                         <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M14.06 9.02l.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"/></svg>
                                    </button>
                                    <button class="delete-btn" title="Supprimer">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>
                                    </button>
                                </div>
                            `;
                             ul.appendChild(li);
                         });
                         section.appendChild(ul);
                         goalsListContainer.appendChild(section);
                     }
                 });

                 // Add message if all goals are filtered out (e.g., by future filters)
                 if (goalsListContainer.children.length === 0 && appData.goals.length > 0) {
                      goalsListContainer.innerHTML = '<p class="text-secondary text-center">Aucun objectif ne correspond aux filtres actuels.</p>';
                 }
             }


             // Render journal entries
             function renderJournal() {
                 journalEntriesList.innerHTML = ''; // Clear
                 if (appData.journal.length === 0) {
                     journalEntriesList.innerHTML = '<p class="text-secondary">Votre journal est vide pour le moment.</p>';
                     return;
                 }

                 // Sort entries descending by date
                 const sortedJournal = [...appData.journal].sort((a, b) => new Date(b.date) - new Date(a.date));

                 sortedJournal.forEach(entry => {
                     const div = document.createElement('div');
                     div.className = 'journal-entry';
                     div.dataset.entryId = entry.id;
                     div.innerHTML = `
                         <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                             <div class="journal-entry-date">${formatDateTime(entry.date)}</div>
                             <button class="delete-journal-btn small-icon-button no-print" title="Supprimer l'entrée" style="background:none; border:none; color: var(--danger-color); cursor:pointer; padding:0; font-size: 1rem;">
                                <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>
                             </button>
                         </div>
                         <div class="journal-entry-content">${escapeHtml(entry.content)}</div>
                     `;
                     journalEntriesList.appendChild(div);
                 });
             }

            // --- Action Handlers ---

            function handleEvaluationSubmit(event) {
                event.preventDefault();
                let evaluationChanged = false;
                const inputs = evaluationItemsContainer.querySelectorAll('input[type="range"]');
                 inputs.forEach(input => {
                    const pillarId = parseInt(input.dataset.pillarId, 10);
                    const newScore = parseInt(input.value, 10);
                    const pillar = appData.pillars.find(p => p.id === pillarId);
                    if (pillar && pillar.score !== newScore) {
                         pillar.score = newScore;
                         evaluationChanged = true;
                    }
                });

                if (evaluationChanged) {
                    appData.settings.lastEvaluationDate = new Date().toISOString();
                    saveData();
                    renderDashboardChart(); // Update chart immediately
                    alert("Évaluation enregistrée !");
                    showView('dashboard-view'); // Go back to dashboard
                } else {
                     alert("Aucune modification détectée dans l'évaluation.");
                }
            }

             function handleGoalSubmit(event) {
                 event.preventDefault();
                 const goalId = document.getElementById('goal-id').value;
                 const title = document.getElementById('goal-title-input').value.trim();
                 const pillarId = parseInt(document.getElementById('goal-pillar-select').value, 10);
                 const measurable = document.getElementById('goal-measurable-input').value.trim();
                 const dueDate = document.getElementById('goal-due-date-input').value;
                 const notes = document.getElementById('goal-notes-input').value.trim();

                 if (!title || !pillarId || !dueDate) {
                     alert("Veuillez remplir le nom, le pilier et la date d'échéance.");
                     return;
                 }

                  const goalData = {
                     pillarId: pillarId,
                     title: title,
                     measurable: measurable,
                     dueDate: dueDate,
                     notes: notes,
                     status: 'pending', // Default status
                 };


                 if (goalId) { // Editing existing goal
                      const index = appData.goals.findIndex(g => g.id === goalId);
                      if (index !== -1) {
                           // Preserve status and creation/completion dates if editing
                           goalData.id = goalId;
                           goalData.status = appData.goals[index].status;
                           goalData.createdAt = appData.goals[index].createdAt;
                           goalData.completedAt = appData.goals[index].completedAt;
                           appData.goals[index] = goalData;
                           alert("Objectif mis à jour !");
                      }
                 } else { // Adding new goal
                     goalData.id = generateId();
                     goalData.createdAt = new Date().toISOString();
                      goalData.completedAt = null;
                      appData.goals.push(goalData);
                      alert("Objectif ajouté !");
                 }

                 saveData();
                 renderGoalsList();
                 renderDashboard(); // Update summaries
                 resetGoalForm();
                 showView('goals-view'); // Show the list after saving
             }

             function handleGoalAction(event) {
                  const button = event.target.closest('button');
                  if (!button) return; // Click wasn't on a button

                  const goalItem = event.target.closest('.goal-item');
                  const goalId = goalItem?.dataset.goalId;
                  if (!goalId) return;

                  if (button.classList.contains('complete-btn')) {
                      markGoalStatus(goalId, 'completed');
                  } else if (button.classList.contains('uncomplete-btn')) {
                       markGoalStatus(goalId, 'pending');
                  } else if (button.classList.contains('edit-btn')) {
                      editGoal(goalId);
                  } else if (button.classList.contains('delete-btn')) {
                      deleteGoal(goalId);
                  }
             }

            function markGoalStatus(goalId, status) {
                 const index = appData.goals.findIndex(g => g.id === goalId);
                 if (index !== -1) {
                     appData.goals[index].status = status;
                      if (status === 'completed') {
                          appData.goals[index].completedAt = new Date().toISOString();
                      } else {
                          appData.goals[index].completedAt = null; // Reset completion date if marked pending again
                      }
                     saveData();
                     renderGoalsList();
                     renderDashboard(); // Update summaries
                 }
             }

             function editGoal(goalId) {
                 const goal = appData.goals.find(g => g.id === goalId);
                 if (goal) {
                     // Populate the form
                     document.getElementById('goal-id').value = goal.id;
                     document.getElementById('goal-title-input').value = goal.title;
                     document.getElementById('goal-pillar-select').value = goal.pillarId;
                     document.getElementById('goal-measurable-input').value = goal.measurable || '';
                     document.getElementById('goal-due-date-input').value = goal.dueDate;
                      document.getElementById('goal-notes-input').value = goal.notes || '';

                     // Change form title and button text
                     goalFormTitle.textContent = "Modifier l'Objectif";
                     goalFormSubmitText.textContent = "Enregistrer les Modifications";

                     // Show the form view
                     showView('add-edit-goal-view');
                 }
             }

             function deleteGoal(goalId) {
                  const goal = appData.goals.find(g => g.id === goalId);
                 if (confirm(`Êtes-vous sûr de vouloir supprimer l'objectif "${goal?.title || 'cet objectif'}" ? Cette action est irréversible.`)) {
                     appData.goals = appData.goals.filter(g => g.id !== goalId);
                     saveData();
                     renderGoalsList();
                      renderDashboard(); // Update summaries
                      alert("Objectif supprimé.");
                 }
             }

             function resetGoalForm() {
                 goalForm.reset(); // Clears most fields
                  document.getElementById('goal-id').value = ''; // Clear hidden ID
                 goalPillarSelect.value = ""; // Reset select explicitly
                 goalFormTitle.textContent = "Ajouter un Objectif";
                 goalFormSubmitText.textContent = "Enregistrer l'Objectif";
             }


            function handleJournalSubmit(event) {
                event.preventDefault();
                const content = journalEntryInput.value.trim();
                if (!content) {
                    alert("L'entrée de journal ne peut pas être vide.");
                    return;
                }

                const newEntry = {
                    id: generateId(),
                    date: new Date().toISOString(),
                    content: content
                };

                appData.journal.push(newEntry);
                saveData();
                renderJournal(); // Update the list
                journalForm.reset(); // Clear the textarea
            }

             function handleJournalAction(event) {
                 const deleteButton = event.target.closest('.delete-journal-btn');
                 if (deleteButton) {
                     const entryItem = event.target.closest('.journal-entry');
                     const entryId = entryItem?.dataset.entryId;
                     if (entryId && confirm("Êtes-vous sûr de vouloir supprimer cette entrée de journal ?")) {
                         appData.journal = appData.journal.filter(entry => entry.id !== entryId);
                         saveData();
                         renderJournal();
                          alert("Entrée de journal supprimée.");
                     }
                 }
             }


            // --- Data Export/Import ---
            function exportData() {
                try {
                    const dataStr = JSON.stringify(appData, null, 2); // Pretty print JSON
                    const blob = new Blob([dataStr], { type: "application/json" });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    const date = new Date().toISOString().slice(0, 10);
                    a.download = `piliers-de-vie-sauvegarde-${date}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                     importStatus.textContent = "Données exportées avec succès.";
                     setTimeout(() => importStatus.textContent = "", 3000);
                } catch (error) {
                    console.error("Error exporting data:", error);
                    alert("Erreur lors de l'exportation des données.");
                      importStatus.textContent = "Erreur lors de l'exportation.";
                }
            }

            function handleImportFile(event) {
                 importStatus.textContent = "Lecture du fichier...";
                const file = event.target.files[0];
                if (!file) {
                     importStatus.textContent = "Aucun fichier sélectionné.";
                    return;
                }
                if (file.type !== "application/json") {
                    alert("Veuillez sélectionner un fichier .json valide.");
                    importStatus.textContent = "Type de fichier invalide.";
                     importInput.value = ""; // Reset input
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                     importStatus.textContent = "Traitement des données...";
                    try {
                        const importedData = JSON.parse(e.target.result);

                        // Basic validation (check for expected top-level keys)
                        if (importedData && importedData.pillars && importedData.goals && importedData.journal && importedData.settings) {
                             if (confirm("Importer ces données écrasera vos données actuelles. Continuer ?")) {
                                // Replace current data
                                appData = importedData;
                                // Re-validate/sanitize data after import if necessary
                                appData.pillars.forEach(p => p.score = Number(p.score) || 5);

                                saveData();
                                // Full re-render
                                applyTheme(appData.settings.theme);
                                renderPillarOptions();
                                renderEvaluationForm();
                                renderDashboard();
                                renderGoalsList();
                                renderJournal();
                                showView('dashboard-view'); // Go to dashboard after import
                                alert("Données importées avec succès !");
                                importStatus.textContent = "Importation réussie.";
                                 setTimeout(() => importStatus.textContent = "", 3000);
                            } else {
                                 importStatus.textContent = "Importation annulée.";
                            }
                        } else {
                            alert("Le fichier JSON ne semble pas contenir la structure de données attendue.");
                             importStatus.textContent = "Structure de données invalide.";
                        }
                    } catch (error) {
                        console.error("Error parsing imported JSON:", error);
                        alert("Erreur lors de la lecture ou du traitement du fichier JSON.");
                         importStatus.textContent = "Erreur lors de l'importation.";
                    } finally {
                          importInput.value = ""; // Reset input value
                    }
                };
                 reader.onerror = function() {
                     alert("Erreur lors de la lecture du fichier.");
                     importStatus.textContent = "Erreur de lecture du fichier.";
                      importInput.value = ""; // Reset input
                 };
                reader.readAsText(file);
            }


            // --- Utility Functions ---
            function generateId() {
                // Simple ID generator (not guaranteed unique in high-concurrency, but fine for client-side)
                return Date.now().toString(36) + Math.random().toString(36).substring(2, 7);
            }

            function formatDate(dateString) {
                if (!dateString) return 'N/A';
                try {
                    const date = new Date(dateString);
                     // Check if it's just a date (YYYY-MM-DD) or a full ISO string
                     if (dateString.length === 10) {
                         // Adjust for potential timezone issues with YYYY-MM-DD by parsing as UTC
                         const [year, month, day] = dateString.split('-');
                         const utcDate = new Date(Date.UTC(year, month - 1, day));
                          return utcDate.toLocaleDateString('fr-FR', { year: 'numeric', month: 'short', day: 'numeric' });
                     } else {
                          return date.toLocaleDateString('fr-FR', { year: 'numeric', month: 'short', day: 'numeric' });
                     }
                } catch (e) {
                    return 'Date invalide';
                }
            }
             function formatDateTime(dateString) {
                 if (!dateString) return 'N/A';
                 try {
                     const date = new Date(dateString);
                     return date.toLocaleString('fr-FR', { dateStyle: 'short', timeStyle: 'short' });
                 } catch (e) {
                     return 'Date invalide';
                 }
             }

             function getGoalTerm(dueDateString) {
                  if (!dueDateString) return 'unknown';
                  try {
                      const dueDate = new Date(dueDateString);
                       // Adjust for potential timezone issues with YYYY-MM-DD
                      const [year, month, day] = dueDateString.split('-');
                      const dueUtc = Date.UTC(year, month - 1, day);
                      const nowUtc = Date.now(); // Compare with current UTC time

                      const diffDays = (dueUtc - nowUtc) / (1000 * 60 * 60 * 24);

                      if (diffDays < 0) return 'past'; // Already past due
                      if (diffDays <= 90) return 'short'; // 0-3 months
                      if (diffDays <= 365) return 'medium'; // 3-12 months
                      return 'long'; // > 1 year
                  } catch(e) {
                       return 'unknown';
                  }
              }


            function escapeHtml(unsafe) {
                if (unsafe === null || unsafe === undefined) return '';
                return unsafe
                    .toString()
                    .replace(/&/g, "&")
                    .replace(/</g, "<")
                    .replace(/>/g, ">")
                    .replace(/"/g, """)
                    .replace(/'/g, "'");
            }


             // --- PWA Service Worker Registration ---
             function registerServiceWorker() {
                 if ('serviceWorker' in navigator) {
                     navigator.serviceWorker.register('sw.js') // Assurez-vous que sw.js est au même niveau
                         .then(registration => {
                             console.log('Service Worker registered with scope:', registration.scope);
                         })
                         .catch(error => {
                             console.error('Service Worker registration failed:', error);
                         });
                 }
             }

            // --- Start the application ---
            init();

        }); // End DOMContentLoaded

    </script>
</body>
</html>
