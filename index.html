<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4A90E2"/>
    <link rel="apple-touch-icon" href="icons/icon-192x192.png"> <!-- Assurez-vous que ce chemin est correct -->
    <link rel="manifest" href="manifest.json"> <!-- Assurez-vous que ce chemin est correct -->

    <title>Objectifs de Vie</title>

    <style>
        /* --- CSS Global & Reset --- */
        :root {
            --font-family-sans: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            --font-family-serif: 'Georgia', 'Times New Roman', Times, serif;

            /* Couleurs Thème Clair (Défaut) */
            --bg-primary: #ffffff; --bg-secondary: #f0f4f8; --text-primary: #2c3e50;
            --text-secondary: #5a7084; --accent-primary: #4A90E2; --accent-secondary: #50E3C2;
            --border-color: #dce4ec; --shadow-color: rgba(0, 0, 0, 0.1);
            --danger-color: #e74c3c; --success-color: #2ecc71; --warning-color: #f39c12;

            /* Couleurs des Piliers */
            --pillar-color-1: #4CAF50; --pillar-color-2: #2196F3; --pillar-color-3: #607D8B;
            --pillar-color-4: #FFC107; --pillar-color-5: #FF9800; --pillar-color-6: #E91E63;
            --pillar-color-7: #9C27B0; --pillar-color-8: #3F51B5;

            /* Tailles & Espacements */
            --spacing-xs: 4px; --spacing-s: 8px; --spacing-m: 16px; --spacing-l: 24px; --spacing-xl: 32px;
            --border-radius: 8px; --header-height: 50px; --nav-height: 60px;
        }

        /* --- Thème Sombre --- */
        body.dark-mode {
            --bg-primary: #1a1a1a; --bg-secondary: #2c2c2c; --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0; --accent-primary: #58a6ff; --accent-secondary: #50E3C2;
            --border-color: #444444; --shadow-color: rgba(255, 255, 255, 0.05);
            --danger-color: #f87171; --success-color: #4ade80; --warning-color: #facc15;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 16px; scroll-behavior: smooth; } /* Added smooth scroll */
        body {
            font-family: var(--font-family-sans); background-color: var(--bg-primary); color: var(--text-primary);
            line-height: 1.6; overscroll-behavior-y: contain; padding-bottom: var(--nav-height);
        }
        #app { max-width: 100%; margin: 0 auto; display: flex; flex-direction: column; min-height: 100vh; }

        /* --- Header --- */
        header {
            background-color: var(--accent-primary); color: white; padding: 0 var(--spacing-m); height: var(--header-height);
            display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 4px var(--shadow-color);
        }
        header h1 { font-size: 1.2rem; font-weight: 600; }
        #theme-toggle { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; padding: var(--spacing-s); margin: calc(var(--spacing-s) * -1); /* Increase tap area */ }

        /* --- Main Content Area --- */
        main#content { flex-grow: 1; padding: var(--spacing-m); padding-bottom: calc(var(--nav-height) + var(--spacing-m)); overflow-y: auto; }

        /* --- View Management --- */
        .view { display: none; animation: fadeIn 0.3s ease-in-out; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Navigation Bar (Bottom) --- */
        nav#bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; height: var(--nav-height); background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; align-items: stretch; /* Stretch items */
            z-index: 100; box-shadow: 0 -2px 5px var(--shadow-color);
        }
        nav#bottom-nav button {
            background: none; border: none; color: var(--text-secondary); display: flex; flex-direction: column;
            align-items: center; justify-content: center; font-size: 0.7rem; padding: var(--spacing-s) var(--spacing-xs); /* Adjust padding */
            cursor: pointer; transition: color 0.2s ease, background-color 0.2s ease; flex-grow: 1; position: relative;
            text-align: center; line-height: 1.2;
        }
        nav#bottom-nav button svg { width: 24px; height: 24px; margin-bottom: var(--spacing-xs); fill: currentColor; }
        nav#bottom-nav button.active { color: var(--accent-primary); font-weight: 600; }
        nav#bottom-nav button:hover:not(.active) { background-color: color-mix(in srgb, var(--border-color), transparent 50%); }
        nav#bottom-nav button.active::after {
            content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 40%; max-width: 40px; /* Max width for indicator */ height: 3px; background-color: var(--accent-primary); border-radius: 3px 3px 0 0;
        }

        /* --- Generic Styles --- */
        .card {
            background-color: var(--bg-secondary); border-radius: var(--border-radius); padding: var(--spacing-m);
            margin-bottom: var(--spacing-m); box-shadow: 0 1px 3px var(--shadow-color); border: 1px solid var(--border-color);
        }
        h2 { color: var(--accent-primary); margin-bottom: var(--spacing-m); font-size: 1.4rem; border-bottom: 2px solid var(--accent-secondary); padding-bottom: var(--spacing-s); }
        h3 { color: var(--text-primary); margin-top: var(--spacing-l); margin-bottom: var(--spacing-s); font-size: 1.1rem; display: flex; align-items: center; gap: var(--spacing-s); scroll-margin-top: calc(var(--header-height) + var(--spacing-m)); /* Offset for sticky header */ }
        .pillar-dot { display: inline-block; width: 12px; height: 12px; border-radius: 50%; vertical-align: middle; flex-shrink: 0; }
        button, input[type="submit"], input[type="button"] { -webkit-tap-highlight-color: transparent; }
        :focus-visible { outline: 3px solid var(--accent-primary); outline-offset: 1px; border-radius: 3px; } /* Improved focus visibility */

        /* --- Buttons --- */
        button.primary, input[type="submit"].primary {
            background-color: var(--accent-primary); color: white; border: none; padding: var(--spacing-s) var(--spacing-m);
            border-radius: var(--border-radius); cursor: pointer; font-size: 1rem; transition: background-color 0.2s ease, transform 0.1s ease;
            display: inline-flex; align-items: center; justify-content: center; gap: var(--spacing-s); line-height: 1.2;
        }
        button.primary:hover:not(:disabled) { background-color: color-mix(in srgb, var(--accent-primary), black 10%); }
        button.primary:active:not(:disabled) { transform: scale(0.98); }
        button.primary:disabled { background-color: var(--text-secondary); cursor: not-allowed; opacity: 0.7; }

        button.secondary {
             background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color);
             padding: var(--spacing-s) var(--spacing-m); border-radius: var(--border-radius); cursor: pointer;
             font-size: 1rem; transition: background-color 0.2s ease; line-height: 1.2;
        }
        button.secondary:hover:not(:disabled) { background-color: color-mix(in srgb, var(--bg-secondary), black 5%); }
        button.secondary:disabled { color: var(--text-secondary); border-color: var(--text-secondary); cursor: not-allowed; opacity: 0.7;}

        button.danger { background-color: var(--danger-color); color: white; }
        button.danger:hover:not(:disabled) { background-color: color-mix(in srgb, var(--danger-color), black 10%); }

        button.icon-button {
             background: none; border: none; padding: var(--spacing-xs); font-size: 1.2rem;
             cursor: pointer; color: var(--text-secondary); transition: color 0.2s ease; line-height: 1; vertical-align: middle;
             border-radius: 50%; /* Make tap target round */
        }
         button.icon-button:hover:not(:disabled) { background-color: color-mix(in srgb, var(--border-color), transparent 50%); color: var(--accent-primary); }
        button.icon-button svg { display: block; }
        button.icon-button.complete-btn { color: var(--success-color); }
        button.icon-button.delete-btn { color: var(--danger-color); }
        button.icon-button:disabled { color: var(--border-color); cursor: not-allowed; opacity: 0.5; }

        /* --- Form Styles --- */
        form label { display: block; margin-bottom: var(--spacing-xs); font-weight: 600; color: var(--text-secondary); }
        form input[type="text"], form input[type="date"], form input[type="number"], form select, form textarea {
            width: 100%; padding: var(--spacing-s); margin-bottom: var(--spacing-m); border: 1px solid var(--border-color);
            border-radius: var(--border-radius); background-color: var(--bg-primary); color: var(--text-primary); font-size: 1rem;
        }
        form textarea { min-height: 100px; resize: vertical; }
        form input:focus, form select:focus, form textarea:focus { /* Match :focus-visible style */
            outline: none; border-color: var(--accent-primary); box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent-primary), transparent 70%);
        }

        /* --- Goals List Styles --- */
        .pillar-goal-section { margin-bottom: var(--spacing-l); }
        .goal-list { list-style: none; padding-left: 0; }
        .goal-item {
            display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
            padding: var(--spacing-s) 0; border-bottom: 1px solid var(--border-color); gap: var(--spacing-s);
        }
        .goal-item:last-child { border-bottom: none; }
        .goal-info { flex-grow: 1; display: flex; align-items: center; gap: var(--spacing-s); min-width: 200px; }
        .goal-title { font-weight: 600; margin-right: auto; word-break: break-word; }
        .goal-item.completed .goal-title { text-decoration: line-through; color: var(--text-secondary); font-weight: normal; }
        .goal-due-date { font-size: 0.8rem; color: var(--text-secondary); white-space: nowrap; }
        .goal-actions { display: flex; align-items: center; flex-shrink: 0; gap: var(--spacing-xs); }

        /* --- Journal Styles --- */
        .journal-entry {
            background-color: var(--bg-secondary); padding: var(--spacing-s) var(--spacing-m);
            border-radius: var(--border-radius); margin-bottom: var(--spacing-m); border-left: 4px solid var(--accent-secondary);
        }
        .journal-entry-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-xs); }
        .journal-entry-date { font-size: 0.8rem; color: var(--text-secondary); }
        .journal-entry-content { white-space: pre-wrap; word-wrap: break-word; }
        .journal-entry .delete-journal-btn { padding: 0; font-size: 1rem; }

        /* --- Settings Styles --- */
        .settings-section { margin-bottom: var(--spacing-xl); }
        .settings-section button { margin-right: var(--spacing-m); margin-bottom: var(--spacing-s); }
        #import-data-input { display: none; }
        #import-export-status { font-size: 0.9rem; margin-top: var(--spacing-s); display: flex; align-items: center; gap: var(--spacing-s); min-height: 22px; /* Prevent layout shift */ }
        .spinner { border: 3px solid var(--border-color); border-top: 3px solid var(--accent-primary); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; display: inline-block; margin-right: var(--spacing-s); }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-indicator { display: none; }
        .loading-indicator.visible { display: inline-flex; align-items: center; }

        /* --- Utility Classes --- */
        .text-center { text-align: center; }
        .mt-1 { margin-top: var(--spacing-s); } .mt-2 { margin-top: var(--spacing-m); }
        .mb-1 { margin-bottom: var(--spacing-s); } .mb-2 { margin-bottom: var(--spacing-m); }
        .text-secondary { color: var(--text-secondary); }
        .no-print {}

        /* --- Toast Notifications --- */
        #toast-container {
            position: fixed; bottom: calc(var(--nav-height) + var(--spacing-m));
            left: 50%; transform: translateX(-50%);
            z-index: 1000; display: flex; flex-direction: column; align-items: center; gap: var(--spacing-s);
            width: calc(100% - 2 * var(--spacing-m)); max-width: 400px; pointer-events: none; /* Allow clicks through container */
        }
        .toast {
            background-color: color-mix(in srgb, var(--text-primary), var(--bg-primary) 20%); color: var(--bg-primary);
            padding: var(--spacing-s) var(--spacing-m); border-radius: var(--border-radius);
            box-shadow: 0 2px 10px var(--shadow-color); font-size: 0.9rem;
            opacity: 0; transition: opacity 0.3s ease, transform 0.3s ease; transform: translateY(10px);
            text-align: center; word-break: break-word; pointer-events: auto; /* Enable clicks on toast itself */
            width: fit-content; max-width: 100%;
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.success { background-color: var(--success-color); color: white; }
        .toast.error { background-color: var(--danger-color); color: white; }
        .toast.warning { background-color: var(--warning-color); color: white; }

        /* --- Responsive --- */
        @media (min-width: 768px) {
            #app { max-width: 800px; }
             main#content { padding-bottom: var(--spacing-xl); }
             nav#bottom-nav { /* Still keep nav at bottom for consistency */ }
             #toast-container { bottom: var(--spacing-m); }
        }

         /* --- Style d'impression --- */
        @media print {
            body { background-color: white !important; color: black !important; font-size: 11pt; padding-bottom: 0; }
            :root { /* Reset colors for print */
                --bg-primary: white; --bg-secondary: #f9f9f9; --text-primary: black;
                --text-secondary: #555; --accent-primary: black; --accent-secondary: #ccc;
                --border-color: #ccc; --danger-color: black; --success-color: black;
            }
            header, nav#bottom-nav, button, input[type="submit"], .no-print, #toast-container { display: none !important; }
            main#content { padding: 1cm; overflow: visible; height: auto; }
            .card, .journal-entry { box-shadow: none !important; border: 1px solid #ccc !important; page-break-inside: avoid; background-color: #f9f9f9 !important; }
            h2, h3 { color: black !important; border-bottom: 1px solid #ccc !important; page-break-after: avoid; }
            h3 { margin-top: var(--spacing-m); } /* Reduce space before H3 in print */
            .goal-item { border-bottom: 1px dotted #ccc; }
            .goal-actions { display: none; }
            .pillar-dot { border: 1px solid #ccc; background-color: lightgray !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .journal-entry { border-left: 4px solid #ccc !important; }
             a { color: black !important; text-decoration: none; }
             a[href^="http"]::after { content: " [" attr(href) "]"; font-size: 9pt; color: #555; word-break: break-all; }
             .goal-item.completed .goal-title { color: #555 !important; text-decoration: none; } /* Remove line-through, just dim */
             .goal-due-date { color: #555 !important; }
        }

    </style>
</head>
<body>
    <div id="app">
        <header>
            <h1>Objectifs de Vie</h1>
            <button id="theme-toggle" aria-label="Changer de thème">🌙</button>
        </header>

        <main id="content">
            <!-- === Vue Liste des Objectifs (Page d'accueil) === -->
            <div id="goals-view" class="view active"> <!-- Active par défaut -->
                <h2>Objectifs par Pilier</h2>
                <div id="goals-list-container">
                    <!-- Contenu généré par JS -->
                    <p class="text-center text-secondary mt-2">Chargement des objectifs...</p>
                </div>
            </div>

             <!-- === Vue Ajout/Modification Objectif === -->
             <div id="add-edit-goal-view" class="view">
                 <h2 id="goal-form-title">Ajouter un Objectif</h2>
                 <form id="goal-form" class="card">
                    <input type="hidden" id="goal-id">
                    <div>
                        <label for="goal-title-input">Nom de l'objectif (Spécifique)</label>
                        <input type="text" id="goal-title-input" required placeholder="Ex: Courir 5km sans m'arrêter">
                    </div>
                    <div>
                        <label for="goal-pillar-select">Pilier de Vie</label>
                        <select id="goal-pillar-select" required>
                           <option value="" disabled selected>Choisir un pilier...</option>
                           <!-- Options générées par JS -->
                        </select>
                    </div>
                    <div>
                        <label for="goal-measurable-input">Critère de succès (Mesurable)</label>
                        <textarea id="goal-measurable-input" placeholder="Ex: Terminer la course, Fréquence hebdomadaire..."></textarea>
                    </div>
                    <div>
                        <label for="goal-due-date-input">Échéance (Temporel)</label>
                        <input type="date" id="goal-due-date-input" required>
                    </div>
                     <div>
                         <label for="goal-notes-input">Notes / Étapes clés (Optionnel)</label>
                        <textarea id="goal-notes-input" placeholder="Étapes : 1. Acheter chaussures, 2. Programme C25K..."></textarea>
                     </div>
                    <div class="form-actions mt-2"> <!-- Group buttons -->
                        <button type="submit" class="primary">
                             <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"/></svg>
                            <span id="goal-form-submit-text">Enregistrer</span> <!-- Shorter text -->
                        </button>
                        <button type="button" id="cancel-goal-form" class="secondary no-print" style="margin-left: var(--spacing-m);">Annuler</button>
                    </div>
                 </form>
            </div>

            <!-- === Vue Journal === -->
            <div id="journal-view" class="view">
                <h2>Journal de Réflexion</h2>
                <div class="card">
                    <form id="journal-form">
                        <label for="journal-entry-input">Nouvelle entrée (liée aux objectifs)</label>
                        <textarea id="journal-entry-input" required placeholder="Notez vos progrès, difficultés, réussites concernant vos objectifs..."></textarea>
                        <button type="submit" class="primary">
                             <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                            Ajouter au Journal
                        </button>
                    </form>
                </div>
                <h3>Entrées précédentes</h3>
                <div id="journal-entries-list">
                    <p class="text-secondary">Votre journal est vide pour le moment.</p>
                </div>
            </div>

            <!-- === Vue Paramètres (Simplifiée) === -->
            <div id="settings-view" class="view">
                <h2>Paramètres</h2>

                <div class="settings-section card">
                     <h3>Préférences</h3>
                     <button id="toggle-theme-button" class="secondary">Basculer Thème Sombre/Clair</button>
                </div>

                <div class="settings-section card">
                    <h3>Données</h3>
                     <p class="text-secondary mb-2">Sauvegardez ou restaurez vos objectifs et journal.</p>
                    <button id="export-data-button" class="secondary">
                         <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 9h-4V3H9v6H5l7 7 7-7zm-8 2V5h2v6h1.17L12 13.17 9.83 11H11zm-6 7h14v2H5v-2z"/></svg>
                        Exporter Données (.json)
                    </button>
                    <button id="import-data-button" class="secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><g><rect fill="none" height="24" width="24"/></g><g><path d="M14,2H6C4.9,2,4,2.9,4,4v16c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V8L14,2z M18,20H6V4h7v5h5V20z M12,12L8,16h3v4h2v-4h3 L12,12z"/></g></svg>
                        Importer Données
                    </button>
                    <input type="file" id="import-data-input" accept=".json">
                    <div id="import-export-status" class="mt-1">
                        <span class="loading-indicator">
                            <span class="spinner"></span>
                            <span class="loading-text">Traitement...</span>
                        </span>
                        <span class="status-message text-secondary"></span>
                    </div>
                </div>

                 <div class="settings-section card">
                    <h3>Aide & Infos</h3>
                     <p class="text-secondary">Version 1.2.0 - Objectifs</p>
                     <p><a href="https://github.com/Malakio80/objectifs-de-vie" target="_blank" rel="noopener noreferrer">Voir sur GitHub</a></p> <!-- Lien mis à jour -->
                     <p>Application simple de suivi d'objectifs personnels.</p>
                </div>
            </div>

        </main>

        <nav id="bottom-nav">
             <!-- Barre de navigation simplifiée -->
            <button class="nav-button active" data-view="goals-view" aria-label="Objectifs">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22L14 6z"/></svg>
                <span>Objectifs</span>
            </button>
             <button class="nav-button" data-view="add-edit-goal-view" aria-label="Ajouter objectif">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></svg>
                <span>Ajouter</span>
             </button>
            <button class="nav-button" data-view="journal-view" aria-label="Journal">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                <span>Journal</span>
            </button>
            <button class="nav-button" data-view="settings-view" aria-label="Paramètres">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.08-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
                <span>Paramètres</span>
            </button>
        </nav>

        <!-- Templates pour contenu dynamique -->
        <template id="goal-item-template">
            <li class="goal-item" data-goal-id="">
                <div class="goal-info">
                    <span class="goal-title"></span>
                    <span class="goal-due-date"></span>
                </div>
                <div class="goal-actions no-print">
                     <button class="icon-button complete-btn" title="Marquer comme terminé">
                         <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M9 16.2l-3.5-3.5c-.39-.39-1.01-.39-1.4 0-.39.39-.39 1.01 0 1.4l4.19 4.19c.39.39 1.02.39 1.41 0L20.3 7.7c.39-.39.39-1.01 0-1.4-.39-.39-1.01-.39-1.4 0L9 16.2z"/></svg>
                     </button>
                     <button class="icon-button uncomplete-btn" title="Marquer comme non terminé" style="display: none;">
                         <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                     </button>
                    <button class="icon-button edit-btn" title="Modifier">
                         <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M14.06 9.02l.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"/></svg>
                    </button>
                    <button class="icon-button delete-btn" title="Supprimer">
                        <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>
                    </button>
                </div>
            </li>
        </template>

        <template id="journal-entry-template">
            <div class="journal-entry" data-entry-id="">
                <div class="journal-entry-header">
                    <div class="journal-entry-date"></div>
                    <button class="icon-button delete-journal-btn no-print" title="Supprimer l'entrée">
                       <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>
                    </button>
                </div>
                <div class="journal-entry-content"></div>
            </div>
        </template>

    </div><!-- /#app -->

    <!-- Toast Notification Container -->
    <div id="toast-container" aria-live="polite"></div>

    <script>
        // Encapsulate all logic in an IIFE
        (() => {
            // --- Constants & Default State ---
            const DEFAULT_PILLARS = [
                { id: 1, name: "Santé physique et bien-être", colorVar: "--pillar-color-1" },
                { id: 2, name: "Développement personnel", colorVar: "--pillar-color-2" },
                { id: 3, name: "Carrière & ambitions", colorVar: "--pillar-color-3" },
                { id: 4, name: "Finances & sécurité", colorVar: "--pillar-color-4" },
                { id: 5, name: "Relations sociales", colorVar: "--pillar-color-5" },
                { id: 6, name: "Amour & vie sentimentale", colorVar: "--pillar-color-6" },
                { id: 7, name: "Loisirs & passions", colorVar: "--pillar-color-7" },
                { id: 8, name: "Contribution & sens", colorVar: "--pillar-color-8" } // Renamed for clarity
            ];

            const RAW_DEFAULT_GOALS = [
                // Santé (1)
                { pillarId: 1, title: "Marcher 30 min, 3 fois/semaine", term: 'short', measurable: "Journal de suivi", notes: "Commencer doucement." },
                { pillarId: 1, title: "Boire 1.5L d'eau par jour", term: 'medium', measurable: "Suivi journalier", notes: "Utiliser une gourde graduée." },
                { pillarId: 1, title: "Atteindre mon poids de forme", term: 'long', measurable: "Poids cible atteint et maintenu", notes: "Combinaison sport + alimentation." },
                // Dév. Perso (2)
                { pillarId: 2, title: "Lire 1 livre non-fiction / mois", term: 'short', measurable: "Livre terminé", notes: "Choisir un livre sur la confiance ce mois-ci." },
                { pillarId: 2, title: "Identifier mes 3 valeurs principales", term: 'medium', measurable: "Liste écrite et réfléchie", notes: "Exercices d'introspection." },
                { pillarId: 2, title: "Apprendre une nouvelle compétence (ex: prise parole)", term: 'long', measurable: "Cours suivi / Pratique régulière", notes: "Rejoindre un club Toastmasters ?" },
                // Carrière (3)
                { pillarId: 3, title: "Mettre à jour mon CV et profil LinkedIn", term: 'short', measurable: "Profils complétés", notes: "Ajouter dernières expériences." },
                { pillarId: 3, title: "Demander un feedback constructif à mon manager", term: 'medium', measurable: "Feedback reçu et plan d'action créé", notes: "Préparer des questions spécifiques." },
                { pillarId: 3, title: "Explorer une nouvelle orientation de carrière", term: 'long', measurable: "Recherches effectuées, contacts pris", notes: "Bilan de compétences ?" },
                // Finances (4)
                { pillarId: 4, title: "Suivre mes dépenses pendant 1 mois", term: 'short', measurable: "Relevé complet des dépenses", notes: "Utiliser une app ou tableur." },
                { pillarId: 4, title: "Économiser 50€ / mois pour un projet spécifique", term: 'medium', measurable: "Montant cible épargné x 6 mois", notes: "Virement automatique." },
                { pillarId: 4, title: "Comprendre et optimiser mes placements", term: 'long', measurable: "Rendez-vous conseiller / Lecture livres", notes: "Définir profil de risque." },
                // Relations (5)
                { pillarId: 5, title: "Organiser un appel vidéo avec un ami éloigné", term: 'short', measurable: "Appel effectué", notes: "Proposer une date cette semaine." },
                { pillarId: 5, title: "Rejoindre un club ou une association", term: 'medium', measurable: "Inscription faite et participation", notes: "Club de lecture, sport, etc." },
                { pillarId: 5, title: "Améliorer ma capacité d'écoute active", term: 'long', measurable: "Feedback positif de mon entourage", notes: "Pratiquer consciemment." },
                // Amour (6)
                { pillarId: 6, title: "Exprimer ma gratitude à mon partenaire / proche quotidiennement", term: 'short', measurable: "Pratique journalière", notes: "Même les petites choses." },
                { pillarId: 6, title: "Planifier une activité spéciale (couple / solo) tous les mois", term: 'medium', measurable: "Activité planifiée et réalisée", notes: "Sortie culturelle, week-end..." },
                { pillarId: 6, title: "Définir ma vision idéale de la relation (ou célibat épanoui)", term: 'long', measurable: "Vision écrite et claire", notes: "Journaling, réflexion." },
                // Loisirs (7)
                { pillarId: 7, title: "Tester une nouvelle recette de cuisine", term: 'short', measurable: "Recette réalisée", notes: "Choisir une recette simple pour commencer." },
                { pillarId: 7, title: "Reprendre un ancien hobby délaissé", term: 'medium', measurable: "Pratique régulière (1h/sem)", notes: "Sortir le matériel (guitare, pinceaux...)." },
                { pillarId: 7, title: "Planifier et réaliser un voyage lié à une passion", term: 'long', measurable: "Voyage effectué", notes: "Voyage photo, rando, culturel..." },
                // Contribution & Sens (8)
                { pillarId: 8, title: "Faire un don (temps ou argent) à une cause", term: 'short', measurable: "Don effectué", notes: "Choisir une association locale." },
                { pillarId: 8, title: "Identifier comment mes compétences peuvent aider les autres", term: 'medium', measurable: "Liste d'idées + 1 action testée", notes: "Mentorat, aide aux devoirs..." },
                { pillarId: 8, title: "Écrire ma 'déclaration de mission' personnelle", term: 'long', measurable: "Déclaration rédigée", notes: "Qu'est-ce qui est important pour moi ?" }
            ];

            // --- Application State Management ---
            const Store = {
                appData: { /* ... initial structure ... */ },
                load() {
                    const savedData = localStorage.getItem('piliersDeVieData');
                    if (savedData) {
                        // ... (logic for loading saved data remains the same) ...
                         try {
                            const parsedData = JSON.parse(savedData);
                            this.appData = {
                                pillars: DEFAULT_PILLARS.map(dp => ({
                                    ...dp,
                                    ...(parsedData.pillars?.find(p => p.id === dp.id) || {})
                                })).sort((a,b) => a.id - b.id),
                                goals: parsedData.goals || [],
                                journal: parsedData.journal || [],
                                settings: { theme: 'light', ...parsedData.settings }
                            };
                             // Ensure goals have valid structure after load
                             this.appData.goals = this.appData.goals.map(g => ({
                                 measurable: '', notes: '', status: 'pending', createdAt: new Date().toISOString(), ...g
                             }));
                            console.log("Data loaded from localStorage");
                        } catch (error) {
                            console.error("Error parsing localStorage data:", error);
                            UI.showToast("Erreur chargement données. Réinitialisation.", 'error');
                            this.resetToDefaultsWithGoals(); // Fallback
                        }
                    } else {
                        // This is where default goals are loaded on first launch
                        console.log("No saved data found, initializing with default goals.");
                        this.resetToDefaultsWithGoals();
                    }
                    // Ensure goals have necessary fields after load/reset
                    this.appData.goals = this.appData.goals.map(g => ({
                        measurable: g.measurable || '',
                        notes: g.notes || '',
                        status: g.status || 'pending',
                        createdAt: g.createdAt || new Date().toISOString(),
                        completedAt: g.completedAt || null,
                        ...g
                    }));
                },
                resetToDefaultsWithGoals() {
                    // ... (logic remains the same - populates goals from RAW_DEFAULT_GOALS) ...
                    const now = new Date();
                    const nowISO = now.toISOString();
                    this.appData = {
                         pillars: JSON.parse(JSON.stringify(DEFAULT_PILLARS)),
                         goals: RAW_DEFAULT_GOALS.map(g => ({
                             ...g,
                             id: Utils.generateId(),
                             status: 'pending',
                             createdAt: nowISO,
                             completedAt: null,
                             dueDate: Utils.calculateDueDate(g.term, now)
                         })),
                         journal: [],
                         settings: { theme: 'light' }
                    };
                    this.save(); // Save these defaults immediately
                    console.log("Initialized with default goals.");
                },
                // ... (save, getters, addGoal, updateGoal, etc. remain the same) ...
                save: function() { /* ... */ },
                getState: function() { return this.appData; },
                getPillars: function() { return this.appData.pillars; },
                getGoals: function() { return this.appData.goals; },
                getJournal: function() { return this.appData.journal; },
                getSettings: function() { return this.appData.settings; },
                getPillarById: function(id) { return this.appData.pillars.find(p => p.id === id); },
                getGoalById: function(id) { return this.appData.goals.find(g => g.id === id); },
                addGoal: function(goalData) { /* ... */ },
                updateGoal: function(goalId, updatedData) { /* ... */ },
                updateGoalStatus: function(goalId, status) { /* ... */ },
                deleteGoal: function(goalId) { /* ... */ },
                addJournalEntry: function(content) { /* ... */ },
                deleteJournalEntry: function(entryId) { /* ... */ },
                updateTheme: function(theme) { /* ... */ },
                importData: function(importedData) { /* ... */ }
            };

             // --- UI Manipulation & Rendering ---
             const UI = {
                elements: { /* ... (same as before) ... */ },
                init() { /* ... (same as before) ... */ },
                renderAllDynamicContent() { /* ... (same as before) ... */ },
                showView(viewId) { /* ... (same as before) ... */ },
                applyTheme(theme) { /* ... (same as before) ... */ },
                toggleTheme() { /* ... (same as before) ... */ },
                showToast(message, type = 'info', duration = 3000) { /* ... (same as before) ... */ },
                getPillarColor(pillarId) { /* ... (same as before) ... */ },
                getPillarName(pillarId) { /* ... (same as before) ... */ },
                renderPillarOptions() { /* ... (same as before) ... */ },
                renderGoalsList() {
                     // ... (This function already handles displaying pillars and goals correctly) ...
                     const container = this.elements.goalsListContainer;
                     container.innerHTML = '';
                     const goals = Store.getGoals();
                     const pillars = Store.getPillars();

                     if (goals.length === 0) { // Should not happen on first load now
                         container.innerHTML = `<p class="text-center text-secondary mt-2">Aucun objectif défini.</p>`;
                         return;
                     }

                     const goalsByPillar = {};
                     pillars.forEach(p => goalsByPillar[p.id] = []);
                     goals.forEach(goal => {
                         if (goalsByPillar[goal.pillarId]) goalsByPillar[goal.pillarId].push(goal);
                         else console.warn("Goal with unknown pillarId:", goal.pillarId);
                     });

                     pillars.forEach(pillar => {
                         const pillarGoals = (goalsByPillar[pillar.id] || []).sort(Utils.sortGoals);
                         // Always render the pillar section, even if empty initially? No, only if goals exist.
                         // The default load ensures goals exist for each pillar initially.
                         if (pillarGoals.length > 0) {
                             const section = document.createElement('div');
                             section.className = 'pillar-goal-section card';
                             // Add ID for potential linking/scrolling
                             section.id = `pillar-section-${pillar.id}`;
                             section.innerHTML = `<h3 id="pillar-title-${pillar.id}">
                                <span class="pillar-dot" style="background-color: ${this.getPillarColor(pillar.id)};"></span>
                                ${Utils.escapeHtml(pillar.name)} (${pillarGoals.filter(g => g.status === 'pending').length} en cours)
                                </h3>`;
                             const ul = document.createElement('ul');
                             ul.className = 'goal-list';
                             ul.dataset.pillarId = pillar.id;

                             pillarGoals.forEach(goal => {
                                 const goalElement = this.createGoalElement(goal);
                                 if (goalElement) ul.appendChild(goalElement);
                             });
                             section.appendChild(ul);
                             container.appendChild(section);
                         }
                     });
                 },
                 createGoalElement(goal) { /* ... (same as before) ... */ },
                 updateGoalElement(goal) { /* ... (same as before) ... */ },
                 addGoalToList(goal) { /* ... (same as before) ... */ },
                 removeGoalFromList(goalId) { /* ... (same as before) ... */ },
                 renderJournal() { /* ... (same as before) ... */ },
                 createJournalEntryElement(entry) { /* ... (same as before) ... */ },
                 addJournalEntryToList(entry) { /* ... (same as before) ... */ },
                 removeJournalEntryFromList(entryId) { /* ... (same as before) ... */ },
                 handleGoalSubmit(event) { /* ... (same as before) ... */ },
                 handleGoalAction(event) { /* ... (same as before) ... */ },
                 editGoal(goalId) { /* ... (same as before) ... */ },
                 deleteGoal(goalId) { /* ... (same as before) ... */ },
                 resetGoalForm() { /* ... (same as before) ... */ },
                 handleJournalSubmit(event) { /* ... (same as before) ... */ },
                 handleJournalAction(event) { /* ... (same as before) ... */ },
                 setLoadingState(isLoading, message = "Traitement...") { /* ... (same as before) ... */ },
                 updateStatusMessage(message, isError = false) { /* ... (same as before) ... */ },
                 exportData() { /* ... (same as before) ... */ },
                 handleImportFile(event) { /* ... (same as before) ... */ },
                 setupEventListeners() { /* ... (same as before) ... */ }
            };

            // --- Utility Functions ---
            const Utils = {
                generateId() { /* ... (same) */ },
                escapeHtml(unsafe) { /* ... (same) */ },
                formatDate(dateString) { /* ... (same) */ },
                formatDateTime(dateString) { /* ... (same) */ },
                sortGoals(a, b) { /* ... (same) */ },
                calculateDueDate(term, baseDate = new Date()) { /* ... (same) */ }
            };

            // --- Main Application Logic & Initialization ---
            const App = {
                init() {
                    document.addEventListener('DOMContentLoaded', () => {
                        // Assign elements after DOM is ready
                        UI.elements = {
                            app: document.getElementById('app'),
                            content: document.getElementById('content'),
                            navButtons: document.querySelectorAll('.nav-button'),
                            views: document.querySelectorAll('.view'),
                            themeToggle: document.getElementById('theme-toggle'),
                            goalForm: document.getElementById('goal-form'),
                            goalFormTitle: document.getElementById('goal-form-title'),
                            goalFormSubmitText: document.getElementById('goal-form-submit-text'),
                            cancelGoalFormButton: document.getElementById('cancel-goal-form'),
                            goalPillarSelect: document.getElementById('goal-pillar-select'),
                            goalsListContainer: document.getElementById('goals-list-container'),
                            journalForm: document.getElementById('journal-form'),
                            journalEntryInput: document.getElementById('journal-entry-input'),
                            journalEntriesList: document.getElementById('journal-entries-list'),
                            exportButton: document.getElementById('export-data-button'),
                            importButton: document.getElementById('import-data-button'),
                            importInput: document.getElementById('import-data-input'),
                            importExportStatus: document.getElementById('import-export-status'),
                            statusMessage: document.querySelector('#import-export-status .status-message'),
                            loadingIndicator: document.querySelector('#import-export-status .loading-indicator'),
                            toggleThemeButton: document.getElementById('toggle-theme-button'),
                            toastContainer: document.getElementById('toast-container'),
                            goalItemTemplate: document.getElementById('goal-item-template'),
                            journalEntryTemplate: document.getElementById('journal-entry-template'),
                        };
                        UI.init();
                    });
                },
                 registerServiceWorker() { /* ... (same) */ }
            };

            // --- Start the application ---
            App.init();

            // --- Add back full function implementations omitted with /* ... */ ---
            // (Copy paste implementations from the previous full code block for Store, UI, Utils, App)
            // Example for Store.save()
             Store.save = function() {
                try {
                    localStorage.setItem('piliersDeVieData', JSON.stringify(this.appData));
                    console.log("Data saved");
                } catch (error) {
                    console.error("Error saving data to localStorage:", error);
                    UI.showToast("Erreur de sauvegarde. Stockage plein ?", 'error');
                }
            };
             // Add back implementations for ALL other functions marked with /* ... */
             // from the previous code block to ensure completeness.
             // ... (paste the rest of the function bodies here) ...
             // [PASTE ALL FUNCTION BODIES HERE]

              // Make sure to include implementations for all functions in Store, UI, Utils, App
              // Including: save, getState, getPillars, getGoals, getJournal, getSettings,
              // getPillarById, getGoalById, addGoal, updateGoal, updateGoalStatus, deleteGoal,
              // addJournalEntry, deleteJournalEntry, updateTheme, importData,
              // init (UI), renderAllDynamicContent, showView, applyTheme, toggleTheme, showToast,
              // getPillarColor, getPillarName, renderPillarOptions, renderGoalsList,
              // createGoalElement, updateGoalElement, addGoalToList, removeGoalFromList,
              // renderJournal, createJournalEntryElement, addJournalEntryToList,
              // removeJournalEntryFromList, handleGoalSubmit, handleGoalAction, editGoal,
              // deleteGoal, resetGoalForm, handleJournalSubmit, handleJournalAction,
              // setLoadingState, updateStatusMessage, exportData, handleImportFile,
              // setupEventListeners, generateId, escapeHtml, formatDate, formatDateTime,
              // sortGoals, calculateDueDate, registerServiceWorker

        })(); // End IIFE
    </script>
</body>
</html>
